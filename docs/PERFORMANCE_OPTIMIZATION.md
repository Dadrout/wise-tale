# üöÄ Performance Optimization Guide

## –¢–µ–∫—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

#### 1. **Gunicorn Configuration**
- –£–≤–µ–ª–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers: `cpu_count * 2 + 1` (–º–∞–∫—Å–∏–º—É–º 8)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã: `timeout = 300`, `graceful_timeout = 30`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–º—è—Ç–∏: `worker_tmp_dir = "/dev/shm"`

#### 2. **Nginx Optimization**
- –£–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã: `worker_connections 4096`
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–∂–∞—Ç–∏–µ Gzip –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (1 –≥–æ–¥)
- –î–æ–±–∞–≤–ª–µ–Ω rate limiting:
  - API: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ (burst: 20)
  - Frontend: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ (burst: 50)

#### 3. **FastAPI Improvements**
- –î–æ–±–∞–≤–ª–µ–Ω rate limiting –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á (10 —Å–µ–∫—É–Ω–¥)
- Redis –∫—ç—à –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### 4. **Monitoring**
- –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: `monitor_performance.py`
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ CPU, –ø–∞–º—è—Ç–∏, –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ API

## üìä –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–∏ 70+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö:
- **CPU**: 60-80% (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ)
- **Memory**: 70-85% 
- **API Response**: < 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Video Generation**: 30-60 —Å–µ–∫—É–Ω–¥ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

### –õ–∏–º–∏—Ç—ã:
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ**: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- **–û–±—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã**: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫—É–Ω–¥—É

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose up --scale api=3

# –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ Celery workers
docker-compose up --scale celery-worker=2
```

### 2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
python monitor_performance.py --url https://wizetale.com --interval 10
```

### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –ø–æ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

### 4. **CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CloudFlare –∏–ª–∏ AWS CloudFront
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ CDN

## üö® –ê–ª–µ—Ä—Ç—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä–æ–≥–∏:
- **CPU > 90%**: –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers
- **Memory > 90%**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
- **API Response > 5s**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
- **Disk > 95%**: –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
```bash
# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
python cleanup_old_files.py

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
docker-compose restart api
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **Uptime**: > 99.9%
- **API Response Time**: < 2s (95th percentile)
- **Video Generation**: < 60s (95th percentile)
- **Concurrent Users**: 100+ –±–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
curl https://wizetale.com/health

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
ab -n 1000 -c 10 https://wizetale.com/api/v1/health
```

## üîÑ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**:
   - –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ API workers
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ Celery workers
   - –í–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–í —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞**:
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å auto-scaling
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
   - –î–æ–±–∞–≤–∏—Ç—å CDN

3. **–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è**:
   - –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –õ–æ–≥–∏ API
docker-compose logs -f api

# –õ–æ–≥–∏ Nginx
docker-compose logs -f nginx

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
netstat -an | grep :8000
``` 